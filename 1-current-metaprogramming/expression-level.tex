\documentclass[../main]{subfiles}
\begin{document}

\section{
  Expression level
}
\label{lbl:expression-level-metaprogramming}

In this chapter I will cover the use of \gls{tmp} for higher levels
of abstraction. Templates can be used to represent whole mathematical
expressions at compile time by creating type-based arborescences.
This type of representation is called an \gls{et} \cite{veldhuizen:1995}.

Combined with compile-time mechanisms such as function overloading,
specialization, and operator overloading, \gls{et}\acrpluralsuffix{} can be used to
implement expression level \gls{dsel}\acrpluralsuffix{} and convert complex
mathematical expressions into high performance code.

There are two main libraries that are able to do just this: Eigen \cite{eigen}
and Blaze \cite{blazelib}, which were cited in \ref{lbl:meta-libraries}.
In this section, I will introduce the basics of \cpp \gls{tmp},

\subsection{
  Expression templates: a type-based representation for math formulas
}

Expression templates are template trees that represent math formulas.
They are generated using operator and function overloading from expressions
that must be known at compile time.

\begin{lstlisting}[
  language=c++
]{}
template<typename Left, typename Right>
struct add_t{};
\end{lstlisting}


\subsection{
  Optimized code generation
}

Enables a whole range of optimizations:

\subsubsection{
  Eliminating temporaries with lazy evaluation
}

\subsubsection{
  Leveraging BLAS libraries
}

\subsubsection{
  Parallelism
}

SIMD

Multithreading

\subsubsection{
  \acrlong{gpu} support efforts
}

Lots of rewrite to do

Potentially a job for source rewriting tools

\begin{itemize}
\item Eventually: \gls{gpu} code generation, although Blaze needs a significant
      rewrite for that. Source rewriting tools might be a good fit for that job.
\end{itemize}

Expression templates can provide expression level APIs for \gls{hpc} libraries.

Still two limitations:

\begin{itemize}
\item Slow compilation times
\item \cpp syntax only
\end{itemize}

Expression templates are aging (pretty well but still).
Newer \cpp standards provide metaprogramming features that can fundamentally
change the way we write metaprograms.

The next part of my thesis will focus on how to leverage these features to
implement \gls{dsel} of arbitrary syntax, and the study of their impact on
compilation times.

\end{document}
